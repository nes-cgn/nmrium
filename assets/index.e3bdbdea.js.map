{"version":3,"file":"index.e3bdbdea.js","sources":["../../src/component/highlight/index.tsx"],"sourcesContent":["import {\n  createContext,\n  useReducer,\n  useMemo,\n  useContext,\n  useCallback,\n  useEffect,\n} from 'react';\n\nexport enum HighlightedSource {\n  PEAK = 'PEAK',\n  INTEGRAL = 'INTEGRAL',\n  SIGNAL = 'SIGNAL',\n  RANGE = 'RANGE',\n  ZONE = 'ZONE',\n  EXCLUSION_ZONE = 'EXCLUSION_ZONE',\n  DATABASE = 'DATABASE',\n  UNKNOWN = 'UNKNOWN',\n}\n\ntype HighlightedSourceType = keyof typeof HighlightedSource;\n\ninterface SourceData {\n  type: HighlightedSourceType;\n  extra?: any;\n}\n\ntype HighlightActions = 'HIDE' | 'SHOW' | 'SET_PERMANENT' | 'UNSET_PERMANENT';\n\ninterface HighlightState {\n  highlights: Record<string, number>;\n  highlighted: string[];\n  highlightedPermanently: string[];\n  sourceData: SourceData | null;\n}\n\ninterface HighlightContextProps {\n  highlight: HighlightState;\n  dispatch: (props: { type: HighlightActions; payload?: any }) => void;\n  remove: () => void;\n}\n\nconst emptyState = {\n  highlight: {\n    highlights: {},\n    highlighted: [],\n    highlightedPermanently: [],\n    sourceData: null,\n  },\n  dispatch: () => null,\n  remove: () => null,\n};\n\nconst highlightContext = createContext<HighlightContextProps>(emptyState);\n\nfunction highlightReducer(state, action) {\n  switch (action.type) {\n    case 'SHOW': {\n      const { convertedHighlights, sourceData } = action.payload;\n      const { type = HighlightedSource.UNKNOWN, extra = null } =\n        sourceData || {};\n\n      const newState = {\n        ...state,\n        highlights: { ...state.highlights },\n        sourceData: { type, extra },\n      };\n      for (const value of convertedHighlights) {\n        if (!(value in newState.highlights)) {\n          newState.highlights[value] = 1;\n        }\n      }\n      newState.highlighted = Object.keys(newState.highlights);\n\n      return newState;\n    }\n    case 'HIDE': {\n      const { convertedHighlights } = action.payload;\n\n      const newState = {\n        ...state,\n        highlights: { ...state.highlights },\n        sourceData: null,\n      };\n      for (const value of convertedHighlights) {\n        if (value in newState.highlights) {\n          // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n          delete newState.highlights[value];\n        }\n      }\n      newState.highlighted = Object.keys(newState.highlights);\n      return newState;\n    }\n    case 'SET_PERMANENT': {\n      const newState = {\n        ...state,\n        // allow just one permanent highlights group at same time\n        highlightedPermanently: action.payload,\n      };\n\n      return newState;\n    }\n    case 'UNSET_PERMANENT': {\n      const newState = {\n        ...state,\n        highlightedPermanently: [],\n      };\n\n      return newState;\n    }\n    default: {\n      throw new Error(`unknown action type: ${action.type}`);\n    }\n  }\n}\n\nexport function HighlightProvider(props) {\n  const [highlight, dispatch] = useReducer(\n    highlightReducer,\n    emptyState.highlight,\n  );\n\n  const contextValue = useMemo(() => {\n    function remove() {\n      dispatch({\n        type: 'HIDE',\n        payload: { convertedHighlights: highlight.highlighted },\n      });\n    }\n    return { highlight, dispatch, remove };\n  }, [highlight]);\n\n  return (\n    <highlightContext.Provider value={contextValue}>\n      {props.children}\n    </highlightContext.Provider>\n  );\n}\n\nexport function useHighlightData() {\n  return useContext(highlightContext);\n}\n\n/**\n * @param {Array<string | number>}  highlights\n * @param {SourceData = null} sourceData\n */\nexport function useHighlight(\n  highlights: (string | number)[],\n  sourceData: SourceData | null = null,\n) {\n  if (!Array.isArray(highlights)) {\n    throw new Error('highlights must be an array');\n  }\n  const { dispatch, highlight } = useHighlightData();\n\n  const convertedHighlights = useMemo(() => {\n    const newHighlights: Array<any> = [];\n    for (const highlight of highlights) {\n      if (typeof highlight !== 'string' && typeof highlight !== 'number') {\n        throw new Error(`highlight key must be a string or number`);\n      }\n      if (highlight !== '') {\n        newHighlights.push(String(highlight));\n      }\n    }\n    return newHighlights;\n  }, [highlights]);\n\n  useEffect(() => {\n    // if deletion of component then also delete its highlight information -> componentWillUnmount\n    return () => {\n      dispatch({\n        type: 'HIDE',\n        payload: { convertedHighlights: [] },\n      });\n      dispatch({\n        type: 'UNSET_PERMANENT',\n      });\n    };\n  }, [dispatch]);\n\n  const isActive = useMemo(() => {\n    return highlight.highlighted.some((key) =>\n      convertedHighlights.includes(key),\n    );\n  }, [convertedHighlights, highlight.highlighted]);\n\n  const isActivePermanently = useMemo(() => {\n    return highlight.highlightedPermanently.some((key) =>\n      convertedHighlights.includes(key),\n    );\n  }, [convertedHighlights, highlight.highlightedPermanently]);\n\n  const show = useCallback(() => {\n    dispatch({\n      type: 'SHOW',\n      payload: {\n        convertedHighlights,\n        sourceData,\n      },\n    });\n  }, [dispatch, convertedHighlights, sourceData]);\n\n  const hide = useCallback(() => {\n    dispatch({\n      type: 'HIDE',\n      payload: {\n        convertedHighlights,\n      },\n    });\n  }, [convertedHighlights, dispatch]);\n\n  const add = useCallback(\n    (id) => {\n      dispatch({\n        type: 'SHOW',\n        payload: { convertedHighlights: [], id },\n      });\n    },\n    [dispatch],\n  );\n\n  const remove = useCallback(\n    (id) => {\n      dispatch({\n        type: 'HIDE',\n        payload: { convertedHighlights: [], id },\n      });\n    },\n    [dispatch],\n  );\n\n  const click = useCallback(\n    (e) => {\n      if (e) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      if (!isActivePermanently) {\n        dispatch({\n          type: 'SET_PERMANENT',\n          payload: convertedHighlights,\n        });\n      } else {\n        dispatch({\n          type: 'UNSET_PERMANENT',\n        });\n      }\n    },\n    [convertedHighlights, dispatch, isActivePermanently],\n  );\n\n  return useMemo(() => {\n    return {\n      isActive,\n      onHover: {\n        onMouseEnter: show,\n        onMouseLeave: hide,\n      },\n      onClick: click,\n      show,\n      hide,\n      isActivePermanently,\n      click,\n      add,\n      remove,\n    };\n  }, [add, click, hide, isActive, isActivePermanently, remove, show]);\n}\n"],"names":["HighlightedSource","emptyState","highlight","highlights","highlighted","highlightedPermanently","sourceData","dispatch","remove","highlightContext","createContext","state","action","type","convertedHighlights","payload","UNKNOWN","extra","newState","value","Object","keys","Error","props","useReducer","highlightReducer","contextValue","useMemo","children","useContext","Array","isArray","useHighlightData","newHighlights","push","String","isActive","some","key","includes","isActivePermanently","show","useCallback","hide","add","id","click","e","preventDefault","stopPropagation","onHover","onMouseEnter","onMouseLeave","onClick"],"mappings":"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"}