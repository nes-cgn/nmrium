{"version":3,"file":"index.f03ef43f.js","sources":["../../src/component/highlight/index.tsx"],"sourcesContent":["import {\n  createContext,\n  useReducer,\n  useMemo,\n  useContext,\n  useCallback,\n  useEffect,\n} from 'react';\n\nexport const TYPES = {\n  PEAK: 'PEAK',\n  INTEGRAL: 'INTEGRAL',\n  SIGNAL: 'SIGNAL',\n  RANGE: 'RANGE',\n  ZONE: 'ZONE',\n  EXCLUSION_ZONE: 'EXCLUSION_ZONE',\n};\n\nconst emptyState = {\n  highlights: {},\n  highlighted: [],\n  highlightedPermanently: [],\n  type: null,\n};\n\nconst highlightContext = createContext<any>(emptyState);\n\nfunction highlightReducer(state, action) {\n  switch (action.type) {\n    case 'SHOW': {\n      const { convertedHighlights, type } = action.payload;\n      const newState = {\n        ...state,\n        highlights: { ...state.highlights },\n        type,\n      };\n      for (const value of convertedHighlights) {\n        if (!(value in newState.highlights)) {\n          newState.highlights[value] = 1;\n        }\n      }\n      newState.highlighted = Object.keys(newState.highlights);\n\n      return newState;\n    }\n    case 'HIDE': {\n      const { convertedHighlights } = action.payload;\n\n      const newState = {\n        ...state,\n        highlights: { ...state.highlights },\n        type: null,\n      };\n      for (const value of convertedHighlights) {\n        if (value in newState.highlights) {\n          // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n          delete newState.highlights[value];\n        }\n      }\n      newState.highlighted = Object.keys(newState.highlights);\n      return newState;\n    }\n    case 'SET_PERMANENT': {\n      const newState = {\n        ...state,\n        // allow just one permanent highlights group at same time\n        highlightedPermanently: action.payload,\n      };\n\n      return newState;\n    }\n    case 'UNSET_PERMANENT': {\n      const newState = {\n        ...state,\n        highlightedPermanently: [],\n      };\n\n      return newState;\n    }\n    default: {\n      throw new Error(`unknown action type: ${action.type}`);\n    }\n  }\n}\n\nexport function HighlightProvider(props) {\n  const [highlight, dispatch] = useReducer(highlightReducer, emptyState);\n  const contextValue = useMemo(() => ({ highlight, dispatch }), [highlight]);\n  return (\n    <highlightContext.Provider value={contextValue}>\n      {props.children}\n    </highlightContext.Provider>\n  );\n}\n\nexport function useHighlightData() {\n  return useContext(highlightContext);\n}\n\nexport function useHighlight(highlights, type: string | null = null) {\n  if (!Array.isArray(highlights)) {\n    throw new Error('highlights must be an array');\n  }\n\n  const context = useHighlightData();\n\n  const convertedHighlights = useMemo(() => {\n    const newHighlights: Array<any> = [];\n    for (const highlight of highlights) {\n      if (typeof highlight !== 'string' && typeof highlight !== 'number') {\n        throw new Error(`highlight key must be a string or number`);\n      }\n      if (highlight !== '') {\n        newHighlights.push(String(highlight));\n      }\n    }\n    return newHighlights;\n  }, [highlights]);\n\n  useEffect(() => {\n    // if deletion of component then also delete its highlight information -> componentWillUnmount\n    return () => {\n      context.dispatch({\n        type: 'HIDE',\n        payload: { convertedHighlights },\n      });\n      context.dispatch({\n        type: 'UNSET_PERMANENT',\n      });\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const isActive = useMemo(() => {\n    return context.highlight.highlighted.some((key) =>\n      convertedHighlights.includes(key),\n    );\n  }, [context.highlight.highlighted, convertedHighlights]);\n\n  const isActivePermanently = useMemo(() => {\n    return context.highlight.highlightedPermanently.some((key) =>\n      convertedHighlights.includes(key),\n    );\n  }, [context.highlight.highlightedPermanently, convertedHighlights]);\n\n  const show = useCallback(() => {\n    context.dispatch({\n      type: 'SHOW',\n      payload: {\n        convertedHighlights,\n        type,\n      },\n    });\n  }, [context, convertedHighlights, type]);\n\n  const hide = useCallback(() => {\n    context.dispatch({\n      type: 'HIDE',\n      payload: {\n        convertedHighlights,\n      },\n    });\n  }, [context, convertedHighlights]);\n\n  const add = useCallback(\n    (id) => {\n      context.dispatch({\n        type: 'SHOW',\n        payload: { convertedHighlights: [], id },\n      });\n    },\n    [context],\n  );\n\n  const remove = useCallback(\n    (id) => {\n      context.dispatch({\n        type: 'HIDE',\n        payload: { convertedHighlights: [], id },\n      });\n    },\n    [context],\n  );\n\n  const click = useCallback(\n    (e) => {\n      if (e) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      if (!isActivePermanently) {\n        context.dispatch({\n          type: 'SET_PERMANENT',\n          payload: convertedHighlights,\n        });\n      } else {\n        context.dispatch({\n          type: 'UNSET_PERMANENT',\n        });\n      }\n    },\n    [context, convertedHighlights, isActivePermanently],\n  );\n\n  const onHover = {\n    onMouseEnter: show,\n    onMouseLeave: hide,\n  };\n\n  const onClick = {\n    onClick: click,\n  };\n\n  return {\n    isActive,\n    show,\n    hide,\n    onHover,\n    onClick,\n    isActivePermanently,\n    click,\n    add,\n    remove,\n  };\n}\n"],"names":["PEAK","INTEGRAL","SIGNAL","EXCLUSION_ZONE","highlights","newHighlights","payload","isActive","context","highlight","highlighted","isActivePermanently","useCallback","type","convertedHighlights","click","preventDefault","show","hide","onHover","onMouseLeave","onClick"],"mappings":"sdAaEA,YACAC,oBACAC,0CAIAC,oCAGAC,+FAQI,0nCA2FKC,wDAKG,OACNC,yEAUH,UAEGC,yBACGC,EAAQC,UAAUC,sCAGxB,CAACF,EAAQC,UAAUC,gBAEhBC,uFAEFH,yCACSI,gGASTJ,UACSI,yFASPJ,+CAIHK,qBAGYC,kCAGTN,MACWI,uCAGdC,2DAOKE,mCAGAC,4IA2BNT,SAAAA,EACAU,KAAAA,EACAC,KAAAA,EACAC,sBAXcF,EACdG,gBAWAC,SAPAA,WAQAV,oBAAAA"}